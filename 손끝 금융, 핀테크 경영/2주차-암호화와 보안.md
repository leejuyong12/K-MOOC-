# 2주차



## 암호화와 보안



### 2-2. 암호화의 개념

- 암호를 사용하는 목적
  - 기밀성(confidentiality)
    - 전달되는 정보를 중간에서 다른 사람이 보지 못하도록 하는 것
    - ex) 계좌 비밀번호 보호
  - 인증(authentication)
    - 정보를 받은 사람 입장에서 보낸 사람이 누구인지 확인할 수 있도록 하는 것
    - 로그인
  - 무결성(integrity)
    - 정보를 받은 사람이 받은 정보와 보낸 사람이 보낸 정보가 동일한지 확인하는 것
    - 이체요청 정보의 변조 여부 확인
  - 부인방지(non-repudiation)
    - 정보를 보낸 사람이나 받은 사람이 정보를 보냈거나 받았다는 사실을 나중에 부인하지 못하도록 하는 것
    - ex) 주문사실 부인 방지

- 암호화 용어정리

  - Plaintext(cleartext : 평문) - 전달해야 할 내용
  - Ciphertext(암호문) - 암호화한 내용
  - Encryption(encipher : 암호화) - 어떤 내용을 위장하는 것
  - Decryption(decipher : 복호화) - 암호문을 평문으로 복구하는 것

  ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633583371340.PNG)

  - Cryptographic analysis(암호 해독) - 공격자의 불법적인 복호화
  - Key(키) - 암호화 알고리즘의 파라미터 - 아주 큰 정수로서 적이 쉽게 얻어낼 수 없는 값을 매개 변수로 활용함   - ex) 2의 256제곱, 2의 2048제곱
    - Key 사용의 장점
      - 보안 체계의 변경이 용이함
      - 다수의 사용자가 같은 보안 체계의 이용이 가능함
    - Key 사용의 단점
      - 가능한 키 값을 모두 시도해보는 공격(Brute-force attack)에 취약함
      - 단점 해결 방법 - 키 크기 상향 / 주기적인 키 갱신 - ex) 공인인증서 갱신
      - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633583638579.PNG)

### 2-3. 암호화 알고리즘과 메시지 다이제스트

- 암호화 알고리즘
  - 대칭형 암호화 알고리즘
    - Symmetrci Algorithm(비밀키 암호화 알고리즘) - Secret Key Algorithm
    - 동일한 한 개의 키를 암호화와 복호화에 공동으로 사용하는 알고리즘
    - Secret Key
    - 장점
      - 암/복호화 속도가 빠름
      - 평문의 길이에 제한이 없음
    - 단점
      - 키 교환이 어려움
    - ex)
      - DES, AES, SEED, IDEA, FEAL, LOKI, ...
  - 비대칭형 암호화 알고리즘
    - Asymmetric Algorithm(공개키 암호화 알고리즘) - Public Key Algorithm
    - 한쌍으로 이루어진 두 개의 키를 암호화와 복호화에 각각 다르게 사용하는 알고리즘
    - Public Key, Private Key
    - 장점
      - 키 교환이 용이함
    - 단점
      - 암/복호화 속도가 느림
      - 평문의 길이에 제한이 있음
    - RSA, Diffie-Hellman, Elliptic Curve Cryptography, ...
- - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633597790997.PNG)
  - Ks - 비밀키
  - E - 암호화
  - D - 복호화
  - Kb - 공개키
  - Kv - 개인키

- ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633597901120.PNG)

- ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633597964211.PNG)

- ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633598013520.PNG)
  - 네트워크의 중간에 있는 공격자가 공개키 Kb를 탈취해도 나중에 암호문을 주고 받는 데 아무런 문제가 없다.
- 비대칭형 암호화 알고리즘의 작동 과정
  - Bob이 키를 생성해서 Alice에게 넘기는 과정

![캡처](md-images/%EC%BA%A1%EC%B2%98-1633598116430.PNG)

![캡처](md-images/%EC%BA%A1%EC%B2%98-1633598150528.PNG)

![캡처](md-images/%EC%BA%A1%EC%B2%98-1633598181402.PNG)

- 만약에 네트워크 중간에 있는 공격자인 Malory가 암호문을 취득해서 해독하려고 한다면 어떻게 될까?
  - 암호문을 해독하려면 Bob의 개인키 Kv가 필요하다.
  - 그런데 Malory는 예전에 네트워크를 통해서 Bob이 Alice한테 보낸 공개키 Kb말고는 아는 것이 없기 때문에 암호문을 해독하는 것은 불가능하다.
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633598286310.PNG)

- 비대칭형 암호화 알고리즘의 작동 과정

  - 네트워크를 통해서 공개키 Kb를 전달하는 것
    - 아무런 문제가 발생하지 않고, 키 교환도 안전하게 이루어진다는 점

  

- 메시지 다이제스트(Message Digest)
  - 평문 같은 메시지를 정해진 크기의 축약값으로 변환하는 기법
  - 유의할 점 : 암호화 기법은 아니지만 전자서명 등에서 유용하게 사용하기 때문에 암호화 과정에서 반드시 필요한 기법
  - 일종의 파일 압축과 비슷함
    - 일반적인 압축파일의 경우, 원래의 파일로 복원이 가능하지만 '메시지 다이제스트'된 축약값은 원래의 메시지로 복원 불가능
      - 단방향 해시(One-way Hash)함수 사용

### 2-4. 전자봉투, 전자서명, 전자인증서

- 전자봉투(Digital Envelope)
  - 평문을 비밀스럽게 전달하는 방법(기밀성)
  - 대칭형 암호화 알고리즘(빠른 속도, 제한없는 평문길이) + 비대칭형 암호화 알고리즘(키 교환)
  - 크기가 큰 평문은 대칭형 암호화 방식으로 암호화 함
  - 대칭형 암호화 방식의 키(비밀키, 세션키)는 크기가 충분히 작음
    - 비대칭형 암호화 방식으로 암호화하여 전송함으로써 키 교환 문제를 해결함
  - 대칭형 암호화 알고리즘(한 개의 비밀키 사용) + 비대칭형 암호화 알고리즘(공개키와 개인키 사용)
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633602596623.PNG)
  - 평문을 보내는 사람을 Alice, 받는 사람을 Bob이라고 하자.
  - Bob이 먼저 자신의 공개키 BKb와 개인키 BKv를 생성한 다음, 
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633602701009.PNG)
  - 이 중에서 공개키인 Bkb만 Alice한테 보낸다. 
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633602749693.PNG)
  - 이제 Alice가 Bob에게 보내야 할 평문이 있다고 했을 때, 
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633602818002.PNG)
  - Alice는 임의로 비밀키 Ks를 생성한 다음, 
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633602862044.PNG)
  - 이 Ks를 키로 평문을 암호화한다.(비밀키Ks=세션키Ks)
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633602932271.PNG)
  - 이어서, Alice는 Bob의 공개키 BKb를 이용해서 세션키 Ks를 암호화한다. 이 암호문을 전자봉투, 또는 Digital Envelope라고 부른다.
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633603015560.PNG)
  - 이제 Alice는 전자봉투와 '평문의 암호문'을 Bob에게 보낸다. 이 두 개의 메시지를 받은 Bob는 자신의 개인키 BKv를 키로 해서 전자봉투를 복호화하고 세션키 Ks를 얻어낸다.
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633603115933.PNG)
  - 그 다음 세션키 Ks를 이용해서 '평문의 암호문'을 복호화하고, Alice의 원래 평문을 얻어낸다.
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633603173786.PNG)
  - 만약에, 적군인 Malory가 중간에서 전자봉투와 암호문을 탈취해서 해독하려 한다면, Bob의 개인키 BKv를 모르기 때문에 전자봉투를 복호화해서 세션키 Ks를 얻어낼 수 없습니다. 세션키 Ks를 모르기 때문에 역시 '평문의 암호문'도 복호화할 수 없습니다.

- 전자서명(Digital Signature)

  - 인증(Authentication)('Alice가 보낸 것인지를 확인한다') + 무결성(integrity)('Alice가 보낸 평문을 중간에 적군이 다른 문장으로 바꿔서 보낸다')
  - '기밀성' 확보와는 또 다른 영역의 암호화 기법
  - 사용동기
    - 메시지의 발신자가 누구인지 확인하기 위해, 그 사람만 아는 키(개인키)로 암호화 되었는지 확인하는 것
    - 평문 전체를 비대칭형 암호화 방식으로 암호화할 수 없으므로, 평문의 메시지 다이제스트를 암호화 함
  - 작동방식
    - 평문의 메시지 다이제스트를 자신만이 아는 개인키로 암호화(전자서명)하여 평문과 함께 보냄
    - 상대방은 전자서명을 공개키로 복호화한 것과 평문을 메시지 다이제스트한 것을 비교하여 동일하면, 전자서명이 그 사람만 아는 키(개인키)로 암호화되었다고 확인함.
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633612735864.PNG)
  - Alice가 먼저 자신의 개인키와 공개키를 생성한 다음에,

  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633612781890.PNG)

  - 이 중에서, 공개키인 AKb만 Bob에게 보낸다.
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633612825713.PNG)

  - Alice는 인증이나 무결성 증명이 필요한 평문이 있을 때 
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633612885425.PNG)
  - 메시지 다이제스트 한 다음에,
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633612924145.PNG)
  - 다시 이것을 자신의 개인키인 AKv로 암호화한다. 이 암호문을 전자서명, 또는 Digital Signature라고 부른다.
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633612976283.PNG)
  - Alice는 평문과 전자서명을 Bob에게 보낸다.
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633613014610.PNG)
  - 이 두 메시지를 받은 Bob는 먼저 Alice의 공개키인 AKb를 이용해서 전자서명을 복호화 한다. 
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633613099316.PNG)
  - 그리고 Alice의 평문을 메시지 다이제스트 한 다음, Alice의 전자서명을 복호화한 것과 비교한다.
  - 메시지 다이제스트의 특성
    - 서로 다른 평문이 동일한 메시지 다이제스트가 되었을 가능성은 통계적으로 희박함(통계적 확률=0)
    - 인증(Authentication)
      - Akb로 복호화되었다는 것은 원래 AKv를 써서 암호화했다는 뜻
      - AKv를 알고 있는 사람은 Alice밖에 없음
      - 이 평문은 Alice가 보내온 것이 통계적으로 확실함
    - 무결성(Integrity)
      - 적군이 중간에 평문을 수정한 경우 두 메시지 다이제스트가 같을 수 없음
      - 통계적으로 확률이 0이므로 평문을 수정하지 않은 것이 통계적으로 확실함
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633613259948.PNG)
  - 만약에 적군인 Malory가 Alice인척 하면서 Bob한테 어떤 평문을 보내려고 하면 그 평문에 대한 전자서명을 만들어야 하는데, 전자서명을 만들기 위해서는 Alice의 개인키가 필요하다. 그런데 Malory는 예전에 전달됐던 Alice의 공개키만 알고 있고 Alice의 개인키는 알지 못하기 때문에 전자서명을 만들 수 없다.

- 전자 인증서(Digital Certificate)

  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633613391904.PNG)
  - Trent = Trusted Third Party(모두가 신뢰할 수 있는 기관) ex) 정부기관
  - CA(Certificate Authority) - 인증기관
  - 사용동기
    - 일반인들(Alice, Bob)사이에 공개키를 안전하게 전달할 방법이 없으므로, Trusted Third Party(Trent)가 공개키를 서명(전자인증서)하여 공개함
  - 작동 방식
    - Trent가 자신의 공개키를 널리 공개함
    - Alice의 공개키를 Trent의 개인키로 암호화(서명)힌 Alice의 전자인증서를 만들어 공개함
    - Alice 전자인증서를 Trent의 공개키로 복호화하여 Alice의 공개키를 확인함
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633613607751.PNG)
  - 먼저 Trent는 자신의 공개키 TKb와 개인키 TKv를 생성한 다음에
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633613666822.PNG)
  - 공개키 TKb를 널리 알린다. Trent는 유명인이기 때문에 적군이 Trent를 사칭하기는 쉽지 않다고 보고, 보통 Trent의 공개키는 보안프로그램을 설치할 때 같이 설치된다.
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633613740101.PNG)
  - Alice는 자신의 공개키인 AKb와 개인키 AKv를 생성한 다음에, 
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633613784126.PNG)
  - 공개키 AKb와 신분증을 가지고 Trent를 찾아간다.
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633613827907.PNG)
  - Trent는 Alice의 신분을 확인하고, 자신의 개인키인 TKv로 AKb를 암호화한다.
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633613893476.PNG)
  - Trent는 Alice의 전자인증서를 Alice에게 준다.
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633613984155.PNG)
  - 실제로는 이 과정이 다르다.
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633614018295.PNG)
  - 이후에 Alice는 인증이나 무결성 증명이 필요한 평문이 있을 때 이것을 메시지 다이제스트 한 다음, 자신의 개인키인 AKv로 암호화해서 전자서명을 만든다.
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633614089026.PNG)
  - 이어서 Alice는 평문, 전자서명, 그리고 전자인증서를 Bob에게 보낸다.
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633614139408.PNG)
  - 이 세개의 메시지를 받은 Bob는 먼저 Trent의 공개키 TKb로 복호화해서 Alice의 공개키 AKb를 얻는다. 이것은 원래 개인키 TKv로 AKb를 암호화했었다는 것을 의미하고, TKv는 Trent의 개인키로서 Trent만 알고 있는 것이기 때문에 AKb는 Trent가 확인한 Alice의 공개키라고 말할 수 있다.
  - 이어서 Bob는 Alice의 공개키인 AKb를 이용해서 Alice의 전자서명을 복호화한다.
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633614311128.PNG)
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633614338981.PNG)
  - Bob은 평문을 메시지 다이제스트 한 다음 Alice의 전자서명을 복호화한 것과 비교한다.
  - 이 두 메시지 다이제스트가 동일하다면, 앞서 전자서명 부분에서 설명한 논리에 따라 인증과 무결성이 확인된 것이다.
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633614414715.PNG)
  - 만약에 Malory가 Alice인척 하면서 자신의 평문 M을 인증과 무결성이 확인되도록, Bob에게 보내려고 한다면 가능할까?
  - 결론은 불가능 하다.
    - 첫번째 이유는, Alice의 개인키인 AKv를 이용해서 전자서명을 만들어야 하는데, Malory는 Alice의 개인키 AKv를 모르기 때문에 전자서명을 만들지 못한다.
    - 두번째 이유는, Alice의 공개키 대신 Malory가 자신의 공개키를 Alice의 공개키인것처럼 Bob에게 보내고자 한다면, Trent의 개인키 TKv를 이용해서 전자인증서를 만들어야 하는데, 역시 Malory는 Trent의 개인키 TKv를 모르기 때문에 전자인증서를 만들지 못한다.

### 2-5. 핀테크를 위한 암호화의 응용

- 공인 인증기관
  - 1999년
    - 시행된 전자거래기본법(전자문서 및 전자거래 기본법) 및 전자서명법이 규정됨
  - 공인된 인증기관이 발행한 전자인증서를 바탕으로 만들어짐
  - 2020년
    - 사법부에서 인정하는 증거 능력을 가짐
  - 공인인증서
    - 공인된 인증기관이 발행한 전자인증서
  - 사설인증서
    - 공인되지 않은 인증기관이 발행한 전자인증서

- 사업 영역별 공인인증기관
  - 금융결제원 : 인터넷 뱅킹
  - 한국증권전산 : 인터넷 증권거래
  - 한국정보화진흥원 : 인터넷 공공거래
  - 한국정보인증 : 일반 인터넷 상거래
  - 한국전자인증 : 일반 인터넷 상거래
  - 한국무역정보통신 : 인터넷 무역 분야
- 전자거래기본법
-  https://www.law.go.kr/LSW/lsInfoP.do?efYd=20110714&lsiSeq=114798#0000
- 전자문서 및 전자거래 기본법
-  https://www.law.go.kr/LSW/lsInfoP.do?efYd=20180425&lsiSeq=198225#0000
- 전자서명법
- https://www.law.go.kr/LSW/lsInfoP.do?efYd=20191210&lsiSeq=212093#0000
- 공인인증서 : GPKI(공공), NPKI(민간)
- 전자서명법 개정안(2020.05.20)
  - 공인인증기관과 공인인증서 개념 관련 조항을 삭제하고 공인전자서명 표현을 전자서명으로 통일함
  - 2020년 11월부터 공인인증서의 독점적 지위가 사라짐
  - 사설인증서 경쟁 (카카오페이, 뱅크사인, 패스, KB모바일인증서 등)
- 공인인증서 개정안
  - ![캡처](md-images/%EC%BA%A1%EC%B2%98-1633615165861.PNG)
